# 3Dモデル読み込み for YMM4

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](#)
[![.NET](https://img.shields.io/badge/.NET-10.0-purple.svg)](#)
[![Release](https://img.shields.io/github/v/release/routersys/YMM4-ObjLoader.svg)](https://github.com/routersys/YMM4-ObjLoader/releases)

YukkuriMovieMaker4 (YMM4) 上で3Dモデルファイルを表示・操作するための高性能な図形プラグインです。
DirectX 11 を活用した描画エンジンと **Assimp (Open Asset Import Library)** の統合により、多様なフォーマットの3Dモデルを高速かつ美しく描画します。
本プラグイン最大の特徴は、読み込んだモデルをパーツごとに分解・再構成できる「階層レイヤーシステム」です。YMM4上でモデルの構造を編集し、パーツ単位での独立したアニメーションや、親子関係を持った複雑な動作を実現します。

![Image](https://github.com/routersys/YMM4-ObjLoader/blob/main/docs/ObjLoader.png)

## 概要

本プラグインは、YMM4で一般的な3Dモデル形式（OBJ, PMX, STL, GLB, FBX, DAE等）の読み込みを可能にします。
単にモデルを表示するだけでなく、モデルに含まれるアクセサリや武器、衣装の一部などを「別のレイヤー」として切り出し、個別に動かしたり、親モデルの動きに追従させたりすることが可能です。
また、物理ベースレンダリング（PBR）を意識した標準描画に加え、トゥーンシェーディング、輪郭線描画、ポストエフェクトなど、映像制作に特化した表現力を備えています。

## 主な機能

### 1. 高度なモデル構造編集とレイヤーシステム
* **パーツ分解**:
  読み込んだ3Dモデルのメッシュ構造を解析し、任意のパーツを選択して**別レイヤーとして切り出す**ことができます。
  * 例：ポットの「蓋」だけを別レイヤー化し、ポットから離れて飛んでいくアニメーションを作る。
  * 例：建物の「ドア」だけを分離し、開閉アニメーションをつける。
* **階層レイヤー構造**:
  レイヤー間には親子関係を設定できます。子レイヤーは親レイヤーの移動・回転・拡大縮小に自動的に追従します。
  * 分離したパーツは自動的に元モデルの子レイヤーとなるため、普段は体に追従し、必要な時だけ独立して動かすといった制御が容易です。
* **マルチモデル管理**:
  1つのアイテム内に複数の異なる3Dモデルファイルを読み込み、それらを組み合わせて1つのオブジェクトとして扱うことができます。

### 2. 直感的な中心点編集
* **ピボット調整機能**:
  モデルの回転や拡大縮小の基準点を、YMM4上で自由に変更できます。外部のモデリングソフトで原点を修正して書き出し直す必要はありません。
* **スナップ機能**:
  モデルの頂点、辺、面を自動検出し、正確な位置に中心点をスナップさせる機能を搭載しています。
  * 「扉のヒンジ部分」や「タイヤの中心」など、正確な回転軸をワンクリックで設定可能です。

### 3. 圧倒的なフォーマット対応
* **Assimp統合**: Assimpライブラリを採用し、業界標準のFBXやCollada(.dae)を含む数十種類のフォーマットに対応。
* **主要対応形式**: .obj, .fbx, .pmx, .pmd, .glb, .gltf, .stl, .dae, .x, .3ds, .blend (非推奨) 他多数。

### 4. 映像表現とレンダリング品質
* **描画品質設定**:
  PCスペックや用途に合わせて、レンダリング品質を「低・標準・高」から選択可能です。
  * **高設定**: マルチサンプリングアンチエイリアス (MSAA x8) と内部解像度のスケーリングにより、ジャギーのない滑らかな映像を出力します。
* **多彩なシェーダー**:
  * **トゥーンシェーダー**: 影の階調化、境界のぼかし調整によるアニメ塗り。
  * **輪郭線**: 色・太さ・検出感度を調整可能なエッジ描画。
  * **リムライト**: 逆光表現によるシルエット強調。
* **ポストエフェクト**:
  周辺減光（ビネット）、走査線、色収差、フォグ、モノクロ化など、コンポジット処理をプラグイン内で完結できます。

### 5. 高度なカメラモーション
* **専用カメラウィンドウ**: YMM4のタイムラインとは独立した、3D空間専用のキーフレームエディタを搭載。
* **イージング制御**: カメラの移動や注視点の動きに対し、グラフエディタを用いた詳細な加減速（イージング）設定が可能です。

## 動作要件

* **OS**: Windows 10 / 11 (64bit)
* **必須ランタイム**: **Microsoft Visual C++ 2015-2022 Redistributable (x64)**
  * 未インストールの場合、プラグインは動作しません。
* **GPU**: DirectX 11 対応のグラフィックスカード

## インストール方法

1. リリースページから最新の `ObjLoader` プラグインファイル（.ymme）をダウンロードしてください。
2. YMM4が起動していないことを確認し、ダウンロードしたファイルを実行（ダブルクリック）してインストールします。
3. YMM4を起動し、「図形」アイテムから「OBJモデル」を選択してください。

## 使い方ガイド

### 基本的な導入フロー
1. アイテムの「ファイル」選択ボタンから3Dモデルを読み込みます。
2. 必要に応じて「レイヤー」ウィンドウを開き、モデルの構造を確認します。
3. パーツを個別に動かしたい場合は「分解」ウィンドウを使用し、パーツをレイヤーに分けます。
4. 回転軸がずれている場合は「中心点」ウィンドウでピボットを修正します。
5. YMM4のタイムラインで位置や回転のアニメーションを設定します。

### ウィンドウ解説

#### 1. レイヤーウィンドウ
モデルを構成するレイヤーの一覧を管理します。
* **選択**: 編集したいレイヤーをクリックして選択します。選択されたレイヤーに対して、YMM4のプロパティ（X, Y, 回転など）が適用されます。
* **親子関係**: 分解機能で作成されたレイヤーは、元モデルの下にインデント表示（子要素化）されます。

#### 2. 分解ウィンドウ
モデルの中身を解析し、パーツ単位でレイヤーに切り出します。
* **パーツ選択**: リストまたは3Dプレビュー上のクリックでパーツを選択します。
* **レイヤーに追加**: 選択したパーツを現在のモデルから除外し、新しい子レイヤーとして独立させます。
  * これにより、元のモデルの整合性を保ったまま、特定部位だけをアニメーションさせることが可能になります。

#### 3. 中心点ウィンドウ
レイヤーの操作中心（ピボット）を調整します。
* **ロック/スキャン**: 「スキャン中」にすると、マウスカーソル下の頂点・辺・面をハイライト表示します。
* **適用**: クリックした位置の座標を中心点として適用します。
* **モード切替**: 頂点(Vertex)・辺(Edge)・面(Face)の中心など、スナップする対象を変更できます。

#### 4. 設定ウィンドウ
* **全体設定**: 座標系（右手/左手、Y-Up/Z-Up）の補正。
* **品質設定**: レンダリング解像度やアンチエイリアス強度の設定。
* **描画エフェクト**: トゥーン、輪郭線、各種ポストプロセスの詳細設定。

## 注意事項

* **プロジェクトファイルの保存**:
  モデルへのファイルパスは絶対パスで保存されます。素材ファイルを移動するとリンク切れになりますのでご注意ください。
* **パフォーマンス**:
  「高画質」設定や多数のポストエフェクト、ハイポリゴンモデルの使用はGPU負荷を高めます。動作が重い場合は設定ウィンドウから画質設定を「標準」または「低」に変更してください。
* **インターネット通信**:
  設定画面を開いた際、更新確認のためにGitHub APIへの通信が行われます（個人情報は送信されません）。
