# 3Dモデル読み込み for YMM4

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](#)
[![.NET](https://img.shields.io/badge/.NET-10.0-purple.svg)](#)
[![Release](https://img.shields.io/github/v/release/routersys/YMM4-ObjLoader.svg)](https://github.com/routersys/YMM4-ObjLoader/releases)

YukkuriMovieMaker4 (YMM4) 上で3Dモデルファイルを表示・操作するための高性能な図形プラグインです。
DirectX 11 を活用した描画エンジンと **Assimp (Open Asset Import Library)** の統合により、非常に多様なフォーマットの3Dモデルを高速かつ美しく描画します。

![Image](https://github.com/routersys/YMM4-ObjLoader/blob/main/docs/ObjLoader.png)

## 概要

本プラグインは、YMM4で一般的な3Dモデル形式（OBJ, PMX, STL, GLB, FBX, DAE等）の読み込みを可能にします。
物理ベースレンダリング（PBR）を意識した標準描画に加え、アニメ調のトゥーンシェーディング、輪郭線描画、ポストエフェクトなど、映像制作に特化した多彩な表現機能を備えています。
また、独立したカメラ編集ウィンドウを搭載しており、複雑なカメラワークを直感的に作成できます。

## 主な機能

### 圧倒的なフォーマット対応とパフォーマンス
* **Assimp統合**: Assimpライブラリを採用し、業界標準のFBXやCollada(.dae)を含む数十種類のフォーマットに対応しました。
* **並列処理とSIMD最適化**: `Parallel.For` によるマルチスレッド読み込みや、SIMD命令を用いた高速な境界計算により、ハイポリゴンモデルもスムーズに扱えます。
* **GPUレンダリング**: DirectX 11 (Shader Model 5.0) によるハードウェアアクセラレーションを活用しています。

### 多彩な映像表現
* **トゥーンシェーダー**: 影の段階数やぼかしを調整できるアニメ塗り機能。
* **輪郭線 (Outline)**: 色、太さ、検出閾値を調整可能な輪郭線描画。
* **リムライト (Rim Light)**: モデルの縁に光を追加し、立体感や逆光表現を強調。
* **ポストエフェクト**:
    * **周辺減光 (Vignette)**: 画面の四隅を暗くし、雰囲気を出します。
    * **走査線 (Scanline)**: ブラウン管テレビのような走査線を追加します。
    * **アートフィルタ**: 色収差、モノクロ、ポスタライズ（階調化）など。

### 高度なカメラモーション
* **専用カメラウィンドウ**: YMM4のタイムラインとは別に、3D空間内でのカメラワークをキーフレーム単位で設定できる専用エディタを搭載。
* **イージンググラフ**: カメラの動きの緩急（イージング）をグラフで視覚的に調整可能。
* **注視点制御**: カメラの位置だけでなく、どこを見ているか（注視点）を制御・固定できます。

## 対応フォーマット

Assimpの統合により、主要なフォーマットを含む多数の形式に対応しています。

* **一般形式**: .obj, .stl, .ply, .3mf, .fbx, .dae (Collada), .x (DirectX), .3ds, .dxf
* **glTF形式**: .glb, .gltf
* **MMD形式**: .pmx, .pmd
* **その他**: .lwo, .lws, .ac, .ms3d, .blend (非推奨) など他多数

## 動作要件

* **Microsoft Visual C++ 2015-2022 Redistributable (x64)** がインストールされている必要があります。
    * 未インストールの場合はプラグインが正常に動作しない（Assimp機能が使えない）可能性があります。

## インストール方法

1. リリースページから最新の `ObjLoader` プラグインファイル（.ymme）をダウンロードしてください。
2. YMM4が起動していないことを確認し、ダウンロードしたファイルを実行（ダブルクリック）してインストールを行ってください。
3. YMM4を起動し、タイムラインの「図形」アイテムから「OBJモデル」を選択することで使用できます。

## 使い方

### 基本操作
1. **モデルの読み込み**:
   アイテムのプロパティにある「ファイル」項目のフォルダアイコンをクリックし、3Dモデルファイルを選択します。
   * 履歴機能により、過去に使用したモデルへ素早くアクセス可能です。

2. **配置と変形**:
   * **位置/回転/スケール**: 3D空間内での配置を調整します。
   * **投影方法**: 平行投影（Parallel）と透視投影（Perspective）を切り替えられます。

3. **シェーダー設定**:
   標準の描画以外に、カスタムシェーダーファイル（.hlsl等）を読み込んで適用することも可能です。

### カメラモーションの設定
プロパティの「カメラ位置設定」ボタンを押すと、専用の**カメラ設定ウィンドウ**が開きます。
* **キーフレーム操作**: タイムライン上でキーを追加し、時間経過に伴うカメラ位置や注視点の移動を作成できます。
* **プレビュー**: 実際の描画結果を確認しながら、マウス操作で直感的にアングルを決定できます。
* **イージング**: キーフレーム間の補間曲線（ベジェカーブ等）を詳細に編集できます。

### 詳細設定（設定ウィンドウ）
プロパティ内の歯車アイコンをクリックすると、ツリー形式の設定ウィンドウが開きます。

#### 全体設定
* **座標系**: モデルの向き（Y-Up/Z-Up、右手系/左手系）を補正します。
* **カリング**: ポリゴンの裏面を描画するかどうかを設定します。

#### 描画設定（トゥーン・輪郭線・リムライト）
* **アニメ調**: 「有効」にすると影が階調化され、アニメのような見た目になります。
* **輪郭線**: モデルのエッジに線を描画します。太さや色を自由に設定可能です。
* **輪郭光**: モデルのシルエットを際立たせるリムライトを設定します。

#### 画面効果 (Post Effect)
* **基本調整**: 彩度、コントラスト、ガンマ、明るさの補正。
* **エフェクト**: フォグ（霧）、ビネット、走査線、色収差などの特殊効果を追加します。

#### Assimp設定
* 各フォーマットごとに、Assimpローダーを使用するかどうかを個別に切り替え可能です。

## 注意事項

### インターネット通信について
本プラグインの設定画面（歯車アイコン）を開いた際、最新バージョンの有無を確認するために **GitHub API (api.github.com) への通信** が行われます。
* この通信は更新通知のみを目的としており、個人情報は送信されません。

### パフォーマンスについて
* 非常に頂点数が多いモデルや、複雑なポストエフェクトを多数重ね掛けした場合、描画負荷が高くなる可能性があります。
* 初回読み込み時には最適化処理が行われるため、ファイルサイズによっては数秒の待機時間が発生することがあります。

### ファイルパスについて
* プロジェクトファイルにはモデルへの絶対パスが保存されます。元のモデルファイルを移動・削除すると表示されなくなりますのでご注意ください。
