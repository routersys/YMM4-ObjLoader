<Window x:Class="ObjLoader.Views.LayerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:l="clr-namespace:ObjLoader.Localization"
        xmlns:layers="clr-namespace:ObjLoader.ViewModels.Layers"
        xmlns:c="clr-namespace:ObjLoader.Converters"
        mc:Ignorable="d"
        Title="{x:Static l:Texts.LayerSettings}" Height="300" Width="250"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
        Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}">
    <Window.Resources>
        <c:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <ListBox Grid.Row="0" ItemsSource="{Binding Layers}" SelectedItem="{Binding SelectedLayer}"
                 HorizontalContentAlignment="Stretch" ScrollViewer.HorizontalScrollBarVisibility="Disabled">
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Grid Height="40">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="40"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0" Width="{Binding IndentMargin.Left}"/>

                        <Border Grid.Column="0" Width="1" Background="Gray" HorizontalAlignment="Right" 
                                Visibility="{Binding LineVisibility}" Margin="0,0,5,0"/>

                        <Button Grid.Column="1" Margin="0,0,2,0" Padding="0" Background="Transparent" BorderThickness="0"
                                Command="{Binding ToggleVisibilityCommand}"
                                ToolTip="{Binding VisibilityTooltip}">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Grid Background="Transparent">
                                        <Grid x:Name="IconGrid" Opacity="0.8">
                                            <Path Data="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z" 
                                                  Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ListBoxItem}}" 
                                                  Stretch="Uniform" 
                                                  Visibility="{Binding IsVisible, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                            <Path Data="M11.83,9L15,12.16C15,12.11 15,12.05 15,12A3,3 0 0,0 12,9C11.94,9 11.89,9 11.83,9M7.53,9.8L9.08,11.35C9.03,11.56 9,11.77 9,12A3,3 0 0,0 12,15C12.22,15 12.44,14.97 12.65,14.92L14.2,16.47C13.53,16.8 12.79,17 12,17A5,5 0 0,1 7,12C7,11.21 7.2,10.47 7.53,9.8M2,4.27L4.28,6.55L4.73,7C3.08,8.3 1.78,10 1,12C2.73,16.39 7,19.5 12,19.5C13.55,19.5 15.03,19.2 16.38,18.66L16.81,19.08L19.73,22L21,20.73L3.27,3L2,4.27M12,7A5,5 0 0,1 17,12C17,12.64 16.87,13.26 16.64,13.82L19.57,16.75C21.07,15.5 22.27,13.86 23,12C21.27,7.61 17,4.5 12,4.5C10.6,4.5 9.26,4.75 8,5.2L10.17,7.35C10.74,7.13 11.35,7 12,7Z" 
                                                  Fill="Gray" 
                                                  Stretch="Uniform" 
                                                  Visibility="{Binding IsVisible, Converter={StaticResource InverseBooleanConverter}}"/>
                                        </Grid>
                                    </Grid>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="IconGrid" Property="Opacity" Value="1.0"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>

                        <Image Grid.Column="2" Source="{Binding ThumbnailSource}" Margin="2"/>

                        <Grid Grid.Column="3" Margin="5,0,0,0" VerticalAlignment="Center">
                            <TextBlock Text="{Binding Name}" TextTrimming="CharacterEllipsis"
                                        ToolTip="{x:Static l:Texts.Layer_Rename}"
                                        Visibility="{Binding IsEditing, Converter={StaticResource InverseBooleanConverter}}">
                                <TextBlock.InputBindings>
                                    <MouseBinding Gesture="LeftDoubleClick" Command="{Binding StartEditCommand}"/>
                                </TextBlock.InputBindings>
                            </TextBlock>
                            <TextBox Text="{Binding Name, UpdateSourceTrigger=LostFocus}"
                                      Visibility="{Binding IsEditing, Converter={StaticResource BooleanToVisibilityConverter}}"
                                      KeyDown="LayerName_KeyDown"
                                      LostFocus="LayerName_LostFocus"
                                      Loaded="LayerName_Loaded"/>
                        </Grid>

                        <Button Grid.Column="4" Margin="5,0,5,0" Width="16" Height="16" Background="Transparent" BorderThickness="0"
                                Visibility="{Binding IsChild, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Grid Background="Transparent">
                                        <Grid x:Name="IconGrid" Opacity="0.7">
                                            <Path Data="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z"
                                                  Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ListBoxItem}}"
                                                  Stretch="Uniform"/>
                                        </Grid>
                                        <Popup IsOpen="{Binding IsMouseOver, RelativeSource={RelativeSource TemplatedParent}, Mode=OneWay}"
                                               Placement="Left"
                                               AllowsTransparency="True">
                                            <Border Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}" 
                                                    BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}" 
                                                    BorderThickness="1" Padding="5">
                                                <StackPanel Orientation="Vertical">
                                                    <ItemsControl ItemsSource="{Binding PartThumbnails}">
                                                        <ItemsControl.ItemsPanel>
                                                            <ItemsPanelTemplate>
                                                                <StackPanel Orientation="Horizontal"/>
                                                            </ItemsPanelTemplate>
                                                        </ItemsControl.ItemsPanel>
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <Image Source="{Binding}" Width="32" Height="32" Margin="2"/>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                    <TextBlock Text="{Binding FileName}" Margin="0,5,0,0" VerticalAlignment="Center" 
                                                               Foreground="{DynamicResource {x:Static SystemColors.WindowTextBrushKey}}"/>
                                                </StackPanel>
                                            </Border>
                                        </Popup>
                                    </Grid>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="IconGrid" Property="Opacity" Value="1.0"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </Grid>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>

        <UniformGrid Grid.Row="1" Rows="1" Height="30">
            <Button ToolTip="{x:Static l:Texts.Layer_Add}" Command="{Binding AddLayerCommand}" Margin="0" Padding="8">
                <Path Data="M0,0 M24,24 M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" 
                      Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" 
                      Stretch="Uniform"/>
            </Button>
            <Button ToolTip="{x:Static l:Texts.Layer_Remove}" Command="{Binding RemoveLayerCommand}" Margin="0" Padding="8">
                <Path Data="M0,0 M24,24 M19,13H5V11H19V13Z" 
                      Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" 
                      Stretch="Uniform"/>
            </Button>
            <Button ToolTip="{x:Static l:Texts.Layer_MoveUp}" Command="{Binding MoveUpLayerCommand}" Margin="0" Padding="8">
                <Path Data="M0,0 M24,24 M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z" 
                      Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" 
                      Stretch="Uniform"/>
            </Button>
            <Button ToolTip="{x:Static l:Texts.Layer_MoveDown}" Command="{Binding MoveDownLayerCommand}" Margin="0" Padding="8">
                <Path Data="M0,0 M24,24 M7.41,8.59L12,13.17L16.59,8.59L18,10L12,16L6,10L7.41,8.59Z" 
                      Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" 
                      Stretch="Uniform"/>
            </Button>
        </UniformGrid>
    </Grid>
</Window>